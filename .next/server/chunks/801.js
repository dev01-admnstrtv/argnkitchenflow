"use strict";exports.id=801,exports.ids=[801],exports.modules={45484:(r,e,o)=>{o.d(e,{EH:()=>i,Fz:()=>p,HT:()=>c,f9:()=>g,fP:()=>d,iu:()=>s,nY:()=>t,tS:()=>n,uU:()=>u}),o(15424);var a=o(46242),t=(0,a.$)("74c3969f7424ac6997a5f91ad7915fdb05f6b38f"),c=(0,a.$)("82441e11eb4d6c890c7abe727d3a1b4900c2b466");(0,a.$)("a3bd33b476d46f7f530b44a019b21a1b6a8f736e");var s=(0,a.$)("21e0e306291fe2f05c26052d2e23ef8f23d646c5"),u=(0,a.$)("9d2a5fb567e9194a150ddc2aab125ce66576ba73"),i=(0,a.$)("edef01a99cb04eea5e097043735594da0f7ab5f9"),d=(0,a.$)("284954a5111b76295f11702df2d8619d725ee491");(0,a.$)("556893c42f4bef40b907b69652abf26e8855d900"),(0,a.$)("be483c5fd4a969b87cd54d10b08cae276c627df9"),(0,a.$)("180e0e9c23642d3a8af36cbe61904e64209d2f37");var n=(0,a.$)("0e807a27a3d2522518fc0a46f91d0581d768a48f");(0,a.$)("c4945a9d374ba28cf161bc1c7636ce906c8f8663");var g=(0,a.$)("39a0bdd73eafadc3b4f7c821657f6b2dd2cea175"),p=(0,a.$)("6e1eb1fc02349bea8e5f1717ea1e41d02d33040d")},145:(r,e,o)=>{o.r(e),o.d(e,{atualizarAgrupamento:()=>v,atualizarProduto:()=>n,buscarAgrupamentoPorId:()=>E,buscarAgrupamentos:()=>m,buscarAgrupamentosPorTipo:()=>b,buscarEstoqueProduto:()=>f,buscarGruposProdutos:()=>p,buscarProdutoPorId:()=>i,buscarProdutos:()=>u,criarAgrupamento:()=>h,criarProduto:()=>d,deletarAgrupamento:()=>S,deletarProduto:()=>g,gerarProximoCodigoProduto:()=>l});var a=o(27745);o(26461);var t=o(1862),c=o(18101),s=o(30207);async function u(r,e,o,a=1,c=20){try{let s=(0,t.createServiceClient)().from("vw_produtos_completos").select("*",{count:"exact"});r&&(s=s.or(`descricao.ilike.%${r}%,produto_id.ilike.%${r}%,grupo.ilike.%${r}%,subgrupo.ilike.%${r}%,agrupamento_descricao.ilike.%${r}%`)),e&&(s=s.eq("tipo",e)),o&&(s=s.eq("grupo",o));let u=(a-1)*c;s=s.order("descricao",{ascending:!0}).range(u,u+c-1);let{data:i,error:d,count:n}=await s;if(d)throw Error("Erro ao buscar produtos: "+d.message);return{success:!0,data:i||[],total:n||0,totalPages:Math.ceil((n||0)/c),currentPage:a}}catch(r){return console.error("Erro ao buscar produtos:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function i(r){try{let e=(0,t.createServiceClient)(),{data:o,error:a}=await e.from("vw_produtos_completos").select("*").eq("id",r).single();if(a)throw Error("Erro ao buscar produto: "+a.message);return{success:!0,data:o}}catch(r){return console.error("Erro ao buscar produto:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function d(r){try{let e=(0,t.createServiceClient)(),o=r.get("custo"),a={produto_id:r.get("produto_id"),descricao:r.get("descricao"),grupo:r.get("grupo"),subgrupo:r.get("subgrupo"),custo:o&&""!==o.trim()?parseFloat(o):void 0,tipo:r.get("tipo"),agrupamento_id:r.get("agrupamento_id")||null},u=c.produtoSchema.parse(a),{data:i,error:d}=await e.from("produtos").insert(u).select().single();if(d)throw Error("Erro ao criar produto: "+d.message);return(0,s.revalidatePath)("/produtos"),{success:!0,data:i}}catch(r){return console.error("Erro ao criar produto:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function n(r,e){try{let o=(0,t.createServiceClient)(),a=e.get("custo"),u={produto_id:e.get("produto_id"),descricao:e.get("descricao"),grupo:e.get("grupo"),subgrupo:e.get("subgrupo"),custo:a&&""!==a.trim()?parseFloat(a):void 0,tipo:e.get("tipo"),agrupamento_id:e.get("agrupamento_id")||null},i=c.produtoSchema.parse(u),{data:d,error:n}=await o.from("produtos").update(i).eq("id",r).select().single();if(n)throw Error("Erro ao atualizar produto: "+n.message);return(0,s.revalidatePath)("/produtos"),{success:!0,data:d}}catch(r){return console.error("Erro ao atualizar produto:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function g(r){try{let e=(0,t.createServiceClient)(),{error:o}=await e.from("produtos").delete().eq("id",r);if(o)throw Error("Erro ao deletar produto: "+o.message);return(0,s.revalidatePath)("/produtos"),{success:!0}}catch(r){return console.error("Erro ao deletar produto:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function p(){try{let r=(0,t.createServiceClient)(),{data:e,error:o}=await r.from("produtos").select("grupo, subgrupo").order("grupo",{ascending:!0});if(o)throw Error("Erro ao buscar grupos: "+o.message);let a=e.reduce((r,e)=>(r[e.grupo]||(r[e.grupo]=new Set),r[e.grupo].add(e.subgrupo),r),{}),c=Object.entries(a).map(([r,e])=>({grupo:r,subgrupos:Array.from(e)}));return{success:!0,data:c}}catch(r){return console.error("Erro ao buscar grupos:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function f(r){try{let e=(0,t.createServiceClient)(),{data:o,error:a}=await e.from("movimento_estoque").select("tipo_movimento, quantidade").eq("produto_id",r);if(a)throw Error("Erro ao buscar estoque: "+a.message);let c=o.reduce((r,e)=>"entrada"===e.tipo_movimento?r+e.quantidade:r-e.quantidade,0);return{success:!0,data:c}}catch(r){return console.error("Erro ao buscar estoque:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function l(r){try{let e=(0,t.createServiceClient)(),o={produto:"PRO",insumo:"INS",produzido:"PP"}[r],{data:a,error:c}=await e.from("produtos").select("produto_id").ilike("produto_id",`${o}%`).order("produto_id",{ascending:!1}).limit(1);if(c)throw Error("Erro ao buscar \xfaltimo c\xf3digo: "+c.message);let s=1;if(a&&a.length>0){let r=a[0].produto_id.match(/\d+/);r&&(s=parseInt(r[0])+1)}let u=`${o}${s.toString().padStart(4,"0")}`;return{success:!0,data:u}}catch(r){return console.error("Erro ao gerar pr\xf3ximo c\xf3digo:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function b(r){try{let e=(0,t.createServiceClient)(),{data:o,error:a}=await e.from("agrupamentos").select("*").eq("tipo",r).eq("ativo",!0).order("grupo",{ascending:!0}).order("subgrupo",{ascending:!0});if(a)throw Error("Erro ao buscar agrupamentos: "+a.message);let c=o.reduce((r,e)=>(r[e.grupo]||(r[e.grupo]=[]),r[e.grupo].push({id:e.id,subgrupo:e.subgrupo,descricao:e.descricao}),r),{});return{success:!0,data:c}}catch(r){return console.error("Erro ao buscar agrupamentos por tipo:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function m(r,e,o=1,a=20){try{let c=(0,t.createServiceClient)().from("agrupamentos").select("*",{count:"exact"}).eq("ativo",!0);r&&(c=c.or(`cod_agrupamento.ilike.%${r}%,grupo.ilike.%${r}%,subgrupo.ilike.%${r}%,descricao.ilike.%${r}%`)),e&&(c=c.eq("tipo",e));let s=(o-1)*a;c=c.order("grupo",{ascending:!0}).order("subgrupo",{ascending:!0}).range(s,s+a-1);let{data:u,error:i,count:d}=await c;if(i)throw Error("Erro ao buscar agrupamentos: "+i.message);return{success:!0,data:u||[],total:d||0,totalPages:Math.ceil((d||0)/a),currentPage:o}}catch(r){return console.error("Erro ao buscar agrupamentos:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function E(r){try{let e=(0,t.createServiceClient)(),{data:o,error:a}=await e.from("agrupamentos").select("*").eq("id",r).single();if(a)throw Error("Erro ao buscar agrupamento: "+a.message);return{success:!0,data:o}}catch(r){return console.error("Erro ao buscar agrupamento:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function h(r){try{let e=(0,t.createServiceClient)(),o={cod_agrupamento:r.get("cod_agrupamento"),grupo:r.get("grupo"),subgrupo:r.get("subgrupo"),descricao:r.get("descricao"),tipo:r.get("tipo"),ativo:"true"===r.get("ativo")},{data:a,error:c}=await e.from("agrupamentos").insert(o).select().single();if(c)throw Error("Erro ao criar agrupamento: "+c.message);return(0,s.revalidatePath)("/produtos"),{success:!0,data:a}}catch(r){return console.error("Erro ao criar agrupamento:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function v(r,e){try{let o=(0,t.createServiceClient)(),a={cod_agrupamento:e.get("cod_agrupamento"),grupo:e.get("grupo"),subgrupo:e.get("subgrupo"),descricao:e.get("descricao"),tipo:e.get("tipo"),ativo:"true"===e.get("ativo")},{data:c,error:u}=await o.from("agrupamentos").update(a).eq("id",r).select().single();if(u)throw Error("Erro ao atualizar agrupamento: "+u.message);return(0,s.revalidatePath)("/produtos"),{success:!0,data:c}}catch(r){return console.error("Erro ao atualizar agrupamento:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}async function S(r){try{let e=(0,t.createServiceClient)(),{data:o,error:a}=await e.from("produtos").select("id").eq("agrupamento_id",r).limit(1);if(a)throw Error("Erro ao verificar produtos: "+a.message);if(o&&o.length>0)throw Error("N\xe3o \xe9 poss\xedvel excluir agrupamento que possui produtos associados");let{error:c}=await e.from("agrupamentos").delete().eq("id",r);if(c)throw Error("Erro ao deletar agrupamento: "+c.message);return(0,s.revalidatePath)("/produtos"),{success:!0}}catch(r){return console.error("Erro ao deletar agrupamento:",r),{success:!1,error:r instanceof Error?r.message:"Erro desconhecido"}}}(0,o(85723).ensureServerEntryExports)([u,i,d,n,g,p,f,l,b,m,E,h,v,S]),(0,a.registerServerReference)("82441e11eb4d6c890c7abe727d3a1b4900c2b466",u),(0,a.registerServerReference)("a3bd33b476d46f7f530b44a019b21a1b6a8f736e",i),(0,a.registerServerReference)("21e0e306291fe2f05c26052d2e23ef8f23d646c5",d),(0,a.registerServerReference)("9d2a5fb567e9194a150ddc2aab125ce66576ba73",n),(0,a.registerServerReference)("edef01a99cb04eea5e097043735594da0f7ab5f9",g),(0,a.registerServerReference)("284954a5111b76295f11702df2d8619d725ee491",p),(0,a.registerServerReference)("556893c42f4bef40b907b69652abf26e8855d900",f),(0,a.registerServerReference)("be483c5fd4a969b87cd54d10b08cae276c627df9",l),(0,a.registerServerReference)("180e0e9c23642d3a8af36cbe61904e64209d2f37",b),(0,a.registerServerReference)("0e807a27a3d2522518fc0a46f91d0581d768a48f",m),(0,a.registerServerReference)("c4945a9d374ba28cf161bc1c7636ce906c8f8663",E),(0,a.registerServerReference)("39a0bdd73eafadc3b4f7c821657f6b2dd2cea175",h),(0,a.registerServerReference)("6e1eb1fc02349bea8e5f1717ea1e41d02d33040d",v),(0,a.registerServerReference)("74c3969f7424ac6997a5f91ad7915fdb05f6b38f",S)}};