"use strict";exports.id=43,exports.ids=[43],exports.modules={38443:(e,a,r)=>{r.d(a,{C:()=>s});var o=r(10326);r(17577);var t=r(51223);function s({className:e,variant:a="default",...r}){return o.jsx("div",{className:(0,t.cn)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}[a],e),...r})}},34397:(e,a,r)=>{r.d(a,{TB:()=>t,Y0:()=>n,ee:()=>s,fZ:()=>c,om:()=>i,uz:()=>d}),r(15424);var o=r(46242),t=(0,o.$)("f7b38b5d72d44934ae34c5abb9ed31b237bb2f91"),s=(0,o.$)("0b128988020d931b3801227f7e3a7a991f113068"),c=(0,o.$)("afd92e16b3eccfcaa3f7edcbe19cf872451c46f4");(0,o.$)("be67c0b1f8237e943f2af5d3652126a25267083b");var i=(0,o.$)("bd01338e5cc667b3a00499d6a73178d804df4f38");(0,o.$)("ef9c5870b8652dd151252a37d98082bfe43e4b6e"),(0,o.$)("1c1ecf1b479d55d9f107760a8436b931971a8036"),(0,o.$)("843b1e4c7b6b72067cd161ed6f65ff23ff423e9e"),(0,o.$)("ecc205928300a790e562d768bb9b36e775812982");var n=(0,o.$)("251f331dde9c786d79c2b1c3502b8bafd163f857"),d=(0,o.$)("17ba19b5bb763570e7afc95a4c26efef1a8055a1");(0,o.$)("a9347c3e4404f0f79aaa9ade295a9bdcb6c6eaf5")},80461:(e,a,r)=>{r.r(a),r.d(a,{aplicarAjustesEstoque:()=>b,buscarDetalhesSeparacao:()=>n,buscarEstatisticasSeparacao:()=>p,buscarHistoricoSeparacao:()=>m,buscarItensEmSeparacao:()=>_,buscarMovimentosPorSolicitacao:()=>v,buscarSolicitacoesPendentes:()=>i,calcularImpactoEstoque:()=>E,cancelarSeparacaoItem:()=>f,concluirSeparacaoItem:()=>u,iniciarSeparacaoItem:()=>d,verificarAjustesEstoqueAplicados:()=>g});var o=r(27745);r(26461);var t=r(1862),s=r(18101),c=r(30207);async function i(e,a,r,o=1,s=20){try{let c=(0,t.createServiceClient)(),i=c.from("vw_separacao_dashboard").select("*",{count:"exact"});e&&(i=i.or(`praca_destino.ilike.%${e}%,solicitante.ilike.%${e}%`)),a&&(i=i.eq("prioridade",a)),r&&(i=i.eq("praca_destino",r));let n=(o-1)*s;i=i.order("prioridade_calculada",{ascending:!1}).order("created_at",{ascending:!0}).range(n,n+s-1);let{data:d,error:u,count:l}=await i;if(u&&u.message.includes('relation "vw_separacao_dashboard" does not exist')){console.log("View n\xe3o existe, usando query manual...");let t=c.from("solicitacoes").select(`
          id as solicitacao_id,
          created_at,
          prioridade,
          prioridade_calculada,
          status,
          observacoes,
          praca_destino:pracas_destino(nome, tipo),
          solicitante:usuarios(nome)
        `,{count:"exact"}).in("status",["pendente","separando"]);e&&(t=t.or(`praca_destino.nome.ilike.%${e}%,solicitante.nome.ilike.%${e}%`)),a&&(t=t.eq("prioridade",a)),r&&(t=t.eq("praca_destino.nome",r)),t=t.order("prioridade_calculada",{ascending:!1}).order("created_at",{ascending:!0}).range(n,n+s-1);let{data:i,error:d,count:u}=await t;if(d)throw Error("Erro ao buscar solicita\xe7\xf5es: "+d.message);let l=i?.map(e=>({solicitacao_id:e.solicitacao_id,created_at:e.created_at,prioridade:e.prioridade,prioridade_calculada:e.prioridade_calculada||0,status:e.status,observacoes:e.observacoes,praca_destino:e.praca_destino?.nome||"N/A",tipo_praca:e.praca_destino?.tipo||"geral",solicitante:e.solicitante?.nome||"N/A",total_itens:0,itens_separados:0,itens_em_falta:0,itens_aguardando:0,itens_separando:0,iniciado_em:null,concluido_em:null,percentual_concluido:0}))||[];return{success:!0,data:l,total:u||0,totalPages:Math.ceil((u||0)/s),currentPage:o}}if(u)throw Error("Erro ao buscar solicita\xe7\xf5es: "+u.message);return{success:!0,data:d||[],total:l||0,totalPages:Math.ceil((l||0)/s),currentPage:o}}catch(e){return console.error("Erro ao buscar solicita\xe7\xf5es pendentes:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function n(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("solicitacoes").select(`
        *,
        praca_destino:pracas_destino(*),
        solicitante:usuarios(*)
      `).eq("id",e).single();if(o)throw Error("Erro ao buscar solicita\xe7\xe3o: "+o.message);let{data:s,error:c}=await a.from("vw_separacao_detalhes").select("*").eq("solicitacao_id",e);if(c)throw Error("Erro ao buscar itens: "+c.message);return{success:!0,data:{solicitacao:r,itens:s||[]}}}catch(e){return console.error("Erro ao buscar detalhes da separa\xe7\xe3o:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function d(e,a){try{let r=(0,t.createServiceClient)(),{data:o,error:s}=await r.from("itens_solicitacao").update({status_separacao:"separando",separado_por_usuario_id:a,iniciado_separacao_em:new Date().toISOString()}).eq("id",e).eq("status_separacao","aguardando").select().single();if(s)throw Error("Erro ao iniciar separa\xe7\xe3o: "+s.message);if(!o)throw Error("Item n\xe3o encontrado ou j\xe1 em separa\xe7\xe3o");return(0,c.revalidatePath)("/separacao"),{success:!0,data:o}}catch(e){return console.error("Erro ao iniciar separa\xe7\xe3o do item:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function u(e){try{let a=(0,t.createServiceClient)(),r={item_id:e.get("item_id"),quantidade_separada:parseFloat(e.get("quantidade_separada")),status:e.get("status"),observacoes:e.get("observacoes")||void 0},o=s.separacaoSchema.parse(r),{data:i,error:n}=await a.from("itens_solicitacao").update({quantidade_separada:o.quantidade_separada,status_separacao:o.status,observacoes_separacao:o.observacoes,concluido_separacao_em:new Date().toISOString()}).eq("id",o.item_id).select().single();if(n)throw Error("Erro ao concluir separa\xe7\xe3o: "+n.message);if(!i)throw Error("Item n\xe3o encontrado");return await l(i.solicitacao_id),(0,c.revalidatePath)("/separacao"),{success:!0,data:i}}catch(e){return console.error("Erro ao concluir separa\xe7\xe3o do item:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function l(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("itens_solicitacao").select("status_separacao").eq("solicitacao_id",e);if(o)throw Error("Erro ao buscar itens da solicita\xe7\xe3o para verifica\xe7\xe3o de status: "+o.message);if(!r||0===r.length)return;if(r.every(e=>"separado"===e.status_separacao||"em_falta"===e.status_separacao)){let{error:r}=await a.from("solicitacoes").update({status:"entregue"}).eq("id",e);if(r)throw Error("Erro ao atualizar status da solicita\xe7\xe3o para entregue: "+r.message);(0,c.revalidatePath)("/solicitacoes")}}catch(e){console.error("Erro em checkAndSetSolicitacaoStatus:",e)}}async function f(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("itens_solicitacao").update({status_separacao:"aguardando",separado_por_usuario_id:null,iniciado_separacao_em:null,observacoes_separacao:null}).eq("id",e).eq("status_separacao","separando").select().single();if(o)throw Error("Erro ao cancelar separa\xe7\xe3o: "+o.message);if(!r)throw Error("Item n\xe3o encontrado ou n\xe3o est\xe1 em separa\xe7\xe3o");return(0,c.revalidatePath)("/separacao"),{success:!0,data:r}}catch(e){return console.error("Erro ao cancelar separa\xe7\xe3o do item:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function p(){try{let e=(0,t.createServiceClient)(),{count:a,error:r}=await e.from("solicitacoes").select("id",{count:"exact",head:!0}).in("status",["pendente","separando"]);if(r)throw Error("Erro ao buscar solicita\xe7\xf5es pendentes: "+r.message);let{count:o,error:s}=await e.from("solicitacoes").select("id",{count:"exact",head:!0});if(s)throw Error("Erro ao buscar total de solicita\xe7\xf5es: "+s.message);let c={solicitacoesPendentes:a||0,percentualConclusao:parseFloat((o>0?(o-(a||0))/o*100:0).toFixed(2))};return{success:!0,data:c}}catch(e){return console.error("Erro ao buscar estat\xedsticas de separa\xe7\xe3o:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function _(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("vw_separacao_detalhes").select("*").eq("separado_por_usuario_id",e).eq("status_separacao","separando").order("iniciado_separacao_em",{ascending:!0});if(o)throw Error("Erro ao buscar itens em separa\xe7\xe3o: "+o.message);return{success:!0,data:r||[]}}catch(e){return console.error("Erro ao buscar itens em separa\xe7\xe3o:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function m(e,a,r,o=1,s=50){try{let c=(0,t.createServiceClient)().from("vw_separacao_detalhes").select("*",{count:"exact"}).in("status_separacao",["separado","em_falta"]);e&&(c=c.eq("separado_por_usuario_id",e)),a&&(c=c.gte("concluido_separacao_em",a)),r&&(c=c.lte("concluido_separacao_em",r));let i=(o-1)*s;c=c.order("concluido_separacao_em",{ascending:!1}).range(i,i+s-1);let{data:n,error:d,count:u}=await c;if(d)throw Error("Erro ao buscar hist\xf3rico: "+d.message);return{success:!0,data:n||[],total:u||0,totalPages:Math.ceil((u||0)/s),currentPage:o}}catch(e){return console.error("Erro ao buscar hist\xf3rico de separa\xe7\xe3o:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function b(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("movimento_estoque").select("id").eq("solicitacao_id",e).limit(1);if(o)throw Error("Erro ao verificar movimenta\xe7\xf5es existentes: "+o.message);if(r&&r.length>0)throw Error("Ajustes de estoque j\xe1 foram aplicados para esta solicita\xe7\xe3o");let{data:s,error:i}=await a.from("solicitacoes").select(`
        *,
        praca_destino:pracas_destino(*)
      `).eq("id",e).single();if(i)throw Error("Erro ao buscar solicita\xe7\xe3o: "+i.message);let{data:n,error:d}=await a.from("itens_solicitacao").select("*").eq("solicitacao_id",e).eq("status_separacao","separado");if(d)throw Error("Erro ao buscar itens: "+d.message);if(!n||0===n.length)return{success:!0,data:{ajustes:0}};let u=n.map(a=>({produto_id:a.produto_id,tipo_movimento:"entrada"===s.tipo?"entrada":"saida",quantidade:a.quantidade_separada,solicitacao_id:e,observacoes:`Separa\xe7\xe3o de solicita\xe7\xe3o - ${s.praca_destino?.nome}${a.observacoes_separacao?` | ${a.observacoes_separacao}`:""}`})),{data:l,error:f}=await a.from("movimento_estoque").insert(u).select();if(f)throw Error("Erro ao criar movimenta\xe7\xf5es: "+f.message);let{error:p}=await a.from("solicitacoes").update({status:"confirmada",updated_at:new Date().toISOString()}).eq("id",e);return p&&console.warn("Erro ao atualizar status da solicita\xe7\xe3o:",p.message),(0,c.revalidatePath)("/separacao"),(0,c.revalidatePath)("/solicitacoes"),{success:!0,data:{ajustes:l.length,movimentacoes:l,tipo_movimento:s.tipo}}}catch(e){return console.error("Erro ao aplicar ajustes de estoque:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function g(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("movimento_estoque").select("id").eq("solicitacao_id",e).limit(1);if(o)throw Error("Erro ao verificar ajustes: "+o.message);return{success:!0,data:{ajustesAplicados:!!(r&&r.length>0)}}}catch(e){return console.error("Erro ao verificar ajustes de estoque:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function v(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("movimento_estoque").select(`
        *,
        produto:produtos(*),
        usuario:usuarios(*)
      `).eq("referencia_id",e).eq("referencia_tipo","solicitacao").order("created_at",{ascending:!1});if(o)throw Error("Erro ao buscar movimenta\xe7\xf5es: "+o.message);return{success:!0,data:r||[]}}catch(e){return console.error("Erro ao buscar movimenta\xe7\xf5es:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function E(e){try{let a=(0,t.createServiceClient)(),{data:r,error:o}=await a.from("itens_solicitacao").select(`
        *,
        produto:produtos(*)
      `).eq("solicitacao_id",e).eq("status_separacao","separado");if(o)throw Error("Erro ao buscar itens: "+o.message);if(!r||0===r.length)return{success:!0,data:{produtos:[],total_produtos:0,valor_total:0}};let s=r.map(e=>{let a=e.produto?.custo||0,r=a*e.quantidade_separada;return{produto_id:e.produto_id,produto_descricao:e.produto?.descricao,quantidade_separada:e.quantidade_separada,valor_unitario:a,valor_total:r}}),c=s.reduce((e,a)=>e+a.valor_total,0);return{success:!0,data:{produtos:s,total_produtos:r.length,valor_total:c}}}catch(e){return console.error("Erro ao calcular impacto no estoque:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}(0,r(85723).ensureServerEntryExports)([i,n,d,u,f,p,_,m,b,g,v,E]),(0,o.registerServerReference)("0b128988020d931b3801227f7e3a7a991f113068",i),(0,o.registerServerReference)("afd92e16b3eccfcaa3f7edcbe19cf872451c46f4",n),(0,o.registerServerReference)("be67c0b1f8237e943f2af5d3652126a25267083b",d),(0,o.registerServerReference)("bd01338e5cc667b3a00499d6a73178d804df4f38",u),(0,o.registerServerReference)("ef9c5870b8652dd151252a37d98082bfe43e4b6e",f),(0,o.registerServerReference)("1c1ecf1b479d55d9f107760a8436b931971a8036",p),(0,o.registerServerReference)("843b1e4c7b6b72067cd161ed6f65ff23ff423e9e",_),(0,o.registerServerReference)("ecc205928300a790e562d768bb9b36e775812982",m),(0,o.registerServerReference)("251f331dde9c786d79c2b1c3502b8bafd163f857",b),(0,o.registerServerReference)("17ba19b5bb763570e7afc95a4c26efef1a8055a1",g),(0,o.registerServerReference)("a9347c3e4404f0f79aaa9ade295a9bdcb6c6eaf5",v),(0,o.registerServerReference)("f7b38b5d72d44934ae34c5abb9ed31b237bb2f91",E)},11480:(e,a,r)=>{r.d(a,{Z:()=>o});let o=(0,r(87926).Z)("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]])}};